<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>消费信贷报表</title>

    <!--<meta name="robots" content="noarchive">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">-->

    <link rel="stylesheet" type="text/css" href="./icon-fonts/iconfont.css">
    <link rel="stylesheet" type="text/css" href="./js/light7/light7.min.css">
    <link rel="stylesheet" type="text/css" href="./css/htable.css">


    <script type='text/javascript' src='./js/jquery.min.js' charset='utf-8'></script>
    <script type="text/javascript" src="./js/tools.js" charset='utf-8'></script>
    <script type="text/javascript" src="./js/jquery.cookie.js"></script>

    <script>
        $.config = {
            autoInit: true
        };
    </script>

    <script type='text/javascript' src='./js/light7/light7.js' charset='utf-8'></script>
    <script type='text/javascript' src='./js/light7/light7-swiper.min.js' charset='utf-8'></script>

    <script type="text/javascript" src="./js/global.js"></script>
    <script type="text/javascript" src="./js/htable.js" charset='utf-8'></script>

    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
        }

        /*ios 点击闪烁*/
        .nav-but {
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            background-color: darkslategray;
            color: white;
        }

        .g-nav {
            position: absolute;
            display: none;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: transparent;
            z-index: 2000;
        }

        .m-nav {
            position: absolute;
            max-width: 360px;
            max-height: 360px;
            width: 70%;
            height: 44%;
            left: 0;
            right: 0;
            bottom: 0;
            top: 0;
            margin: auto;
            border-radius: 5px;
            -moz-border-radius: 5px;
            background: #000 url(imgs/bg9.jpg) no-repeat;
            background-size: cover;
            transform: scale(.2);
            opacity: 0;
        }

        .navAnimate {
            transform: scale(1);
            opacity: 1;
            overflow: hidden;
        }

        .items {
            width: calc(100% + 16px);
            height: 100%;
            padding: 15px 10px;
            box-sizing: border-box;
            background-color: hsla(176, 87%, 40%, .3);
            overflow-y: scroll;
        }

        .item {
            display: block;
            float: left;
            text-align: center;
            box-sizing: border-box;
            color: #fff;
            cursor: pointer;
        }

        .item.select {
            color: #FFC107;
            border: 1px solid #ff9800;
        }

        .cacheNav {
            float: left;
            width: 100%;
            background-color: rgba(255, 255, 255, .3);
            overflow-x: auto;
        }

        .cacheItems {
            width: auto;
            height: 100%;
            overflow-y: hidden;
        }

        .cacheItem {
            position: relative;
            display: inline-block;
            text-align: center;
            height: 100%;
            font-size: 14px;
        }

        .cacheItem:after {
            position: absolute;
            right: 0;
            content: "";
            top: 30%;
            width: 1px;
            height: 40%;
            background-color: #736f6a;
        }

        .cacheItem:after:nth-last-child {
            width: 0;
        }

        @media all and (max-width: 960px) {
            .items {
                width: 100%;
            }
        }
    </style>

</head>

<body>
    <div class="page-group" style="margin: 0 auto;">
        <div class="page" id='homepage'></div>
        <div class="page" id='apply'></div>
        <div class="page" id='finalReview'></div>
        <div class="page" id='mobileReview'></div>
        <div class="page" id='firstReview'></div>
        <div class="page" id='secondReview'></div>
        <div class="page" id='reviewTotal'></div>
        <div class="page" id='contractSign'></div>
    </div>
    <section class="g-nav">
        <section class="m-nav">

        </section>
    </section>

    <script>
        $(document).ready(function () {

            //TODO
            var stoken = $.cookie("userName");
            console.log(stoken);
            if(stoken){
                if (g.terminal === "pc") {
                    $("body").width(g.maxWidth);
                    $("body").css("margin", "0 auto");
                }
                g.loadPage("homepage", true);
            }else {
                window.location.href = "/login.html";
            }


        });

        var n = {
            arr: ["首页", "申请", "审批", "签约", "放款", "统计"],
            cacheNavData: {
                "申请": [
                    {"name": '申请', "page": 'apply'}
                ],
                "审批": [
                    {"name": '电审', "page": 'mobileReview'},
                    {"name": '初审', "page": 'firstReview'},
                    {"name": '复审', "page": 'secondReview'},
                    {"name": '终审', "page": 'finalReview'},
                    {"name": '汇总', "page": 'reviewTotal'},
                    {"name": '信审专员', "page": ''}
                ],
                "签约": [
                    {"name": '面签', "page": 'contractSign'}
                ],
                "放款": [
                    {"name": '放款', "page": ''}
                ],
                "统计": [
                    {"name": '汇总', "page": ''}
                ]
            },
            nav: $('.g-nav'),
            init: function () {
                var self = this;
                setTimeout(function () {
                    // 创建dom
                    var ul = $('<ul class="items"></ul>');
                    self.nav.height(window.innerHeight);

                    var h = self.nav.height() * 0.44 > 330 ? 330 : self.nav.height() * 0.44 - 30;
                    // 设置样式；
                    for (var i = 0; i < self.arr.length; i++) {
                        var li = $('<li class="item" style="font-size:16px;"></li>');
                        if (self.arr.length < 7) {
                            li.html(self.arr[i]).css({
                                'width': '50%',
                                'height': h / Math.ceil(self.arr.length / 2) + 'px',
                                'line-height': h / Math.ceil(self.arr.length / 2) + 'px'
                            });
                            if (i > 1) {// 除第一行之外的所有行 上移 1像素 保持边框一致。
                                li.css({'margin-top': '-1px'});
                            }
                            if (i % 2 == 1) {
                                li.css({'margin-left': '-1px'});
                            }
                        } else {
                            li.html(self.arr[i]).css({
                                'width': 100 / 3 + '%',
                                'height': h / Math.ceil(self.arr.length / 3) + 'px',
                                'line-height': h / Math.ceil(self.arr.length / 3) + 'px'
                            });
                            if (i > 2) {// 除第一行之外的所有行 上移 1像素 保持边框一致。
                                li.css({'margin-top': '-1px'});
                            }
                            if (i % 2 == 1) {
                                li.css({'margin-left': '-1px'});
                            }
                        }
                        ul.append(li);
                    }
                    self.nav.children().append(ul);
                    self.events();
                }, 300);
            },
            events: function () {
                this.navControl();
            },
            navControl: function () {
                var self = this;
                // 关闭导航页
                self.nav.click(function () {
                    self.nav.hide(300);
                    self.nav.find('li').removeClass('select');
                    $('.cacheNav').remove();
                });
                // 导航菜单阻止事件捕获
                self.nav.children().click(function (e) {
                    e.stopPropagation();
                });
                //  菜单操作
                self.nav.children().delegate('.item', 'click', function () {
                    $('.cacheNav').remove();// 清空二级菜单
                    if ($(this).hasClass('select')) { // 当前导航为已选中导航，return;
                        $(this).removeClass('select');
                        $(this).parent().css('overflow-y', 'hidden');
                        return;
                    }
                    // 添加选中样式，获取导航个数用来判断排列布局。
                    $(this).addClass('select').siblings().removeClass('select');
                    /*TODO*/
                    if($(this).text().indexOf('首页') > -1){
                        $(this).removeClass('select');
                        $(".g-nav").hide();
                        g.loadPage("homepage", false);
                        return;
                    };
                    var leng = self.arr.length; // 一级菜单个数；
                    var thisIndex = $(this).index();
                    var index = 0;//eq(i) 后添加二级导航 ， i为索引号；
                    var t = $(this).text();
                    if (leng < 8) {// 两列
                        index = thisIndex % 2 == 0 ? thisIndex + 1 : thisIndex;
                    } else {// 三列
                        if ((thisIndex + 1) % 3 == 0) {
                            index = thisIndex
                        };//2
                        if ((thisIndex + 1) % 3 == 1) {
                            index = thisIndex + 2
                        };//1
                        if ((thisIndex + 1) % 3 == 2) {
                            index = thisIndex + 1;
                        }//0
                    }
                    var cacheBox = $('<div class="cacheNav"></div>'); // 二级导航盒子
                    // 判断i是否能取到对应dom
                    cacheBox.animate({"height": $(this).height() / 2}, 100);// 二级菜单设置高度
                    if ($(this).parent().children().eq(index).index() == self.arr.length - 1) {
                        $(this).parent().append(cacheBox).scrollTop($(this).parent().height() + 48);
                    } else {
                        $(this).parent().children().eq(index).after(cacheBox);
                    }
                    $(this).parent().css('overflow-y', 'scroll');
                    // 为二级菜单添加内容。
                    if (!self.cacheNavData[t])return;
                    var cacheItems = $('<ul class="cacheItems"></ul>').css('width', self.cacheNavData[t].length * $(this).width())
                    for (var i = 0; i < self.cacheNavData[t].length; i++) {
                        var a = '<li class="cacheItem"'
                            + 'style="width:' + $(this).width() + 'px;line-height:' + $(this).height() / 2 + 'px;"'
                            + 'data-page="' + self.cacheNavData[t][i].page + '"'
                            + 'onclick="g.pageChange(this)"'
                            + '>' + self.cacheNavData[t][i].name + '</li>';
                        cacheItems.append(a);
                    };
                    cacheBox.append(cacheItems);
                });
            }
        };
        n.init();

        //页面跳转
        g.pageChange = function (e) {
            var u = $(e).attr('data-page');
            $('.item').removeClass('select');
            $(".g-nav").hide();
            g.loadPage(u, false);
        };

    </script>

</body>

</html>